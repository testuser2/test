var prefs=new gadgets.Prefs,weather=null;window.oncontextmenu=function(){return!1};var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-41395348-5"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=!0;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();
function readyEvent(){gadgets.rpc.call("","rsevent_ready",null,prefs.getString("id"),!1,!1,!1,!0,!1)}
$(document).ready(function(){var b=prefs.getString("id"),a=prefs.getString("background-color");document.body.onmousedown=function(){return!1};null!=a&&""!=a&&(document.body.style.background=a);prefs.getBool("terms")?(weather=new RiseVision.Weather.Controller,b&&(gadgets.rpc.register("rsparam_set_"+b,weather.getAdditionalParams),gadgets.rpc.call("","rsparam_get",null,b,"additionalParams"))):($(".container").hide(),$(".error").text("You must check the Acceptance setting in order to use this Gadget.").show(),
readyEvent())});var RiseVision=RiseVision||{};RiseVision.Weather={};RiseVision.Weather.Controller={};
RiseVision.Weather.Controller=function(){prefs.getInt("rsW");prefs.getInt("rsH");prefs.getString("layout");this.isLoading=!0;this.imagesLoaded=0;this.refreshInterval=18E5;this.errorInterval=6E4;this.layout=prefs.getString("layout");this.hostURL="https://s3.amazonaws.com/Widget-Weather/";this.url=unescape("%68%74%74%70%3a%2f%2f%77%77%77%2e%74%69%6e%62%75%77%65%61%74%68%65%72%2e%63%6f%6d%2f%77%78%5f%66%65%65%64%2f%77%78%5f%63%75%72%72%65%6e%74%5f%65%78%74%65%6e%64%65%64%5f%62%79%5f%6e%61%6d%65%2e%70%68%70%3f%70%61%73%73%63%6f%64%65%3d%72%69%73%65%64%69%73%70%6c%61%79%25%37%43%64%6b%61%63%26%6d%65%74%72%69%63%3d%66%61%6c%73%65");this.geoURL=
unescape("%68%74%74%70%3a%2f%2f%77%77%77%2e%74%69%6e%62%75%77%65%61%74%68%65%72%2e%63%6f%6d%2f%77%78%5f%66%65%65%64%2f%77%78%5f%63%75%72%72%65%6e%74%5f%65%78%74%65%6e%64%65%64%5f%62%79%5f%6c%61%74%6c%6f%6e%2e%70%68%70%3f%70%61%73%73%63%6f%64%65%3d%72%69%73%65%64%69%73%70%6c%61%79%25%37%43%64%6b%61%63%26%6d%65%74%72%69%63%3d%66%61%6c%73%65")};
RiseVision.Weather.Controller.prototype.getAdditionalParams=function(b,a){var c;"additionalParams"==b?a&&(document.createElement("style"),a=JSON.parse(a),weather.customDescription=a["custom-description"],"three-day"!=weather.layout&&(weather.currentTempFont=new RiseVision.Common.Font(a["current-temp-font"],a["current-temp-font-style"],a["current-temp-font-url"],"currentTempFont"),weather.currentTempFontSize=a["current-temp-font-size"],weather.currentTempBold=a["current-temp-bold"],weather.currentTempItalic=
a["current-temp-italic"],weather.currentTempColor=a["current-temp-color"]),"current"!=weather.layout&&(weather.forecastTempFont=new RiseVision.Common.Font(a["forecast-temp-font"],a["forecast-temp-font-style"],a["forecast-temp-font-url"],"forecastTempFont"),weather.forecastTempFontSize=a["forecast-temp-font-size"],weather.forecastTempBold=a["forecast-temp-bold"],weather.forecastTempItalic=a["forecast-temp-italic"],weather.forecastTempColor=a["forecast-temp-color"],weather.forecastDayFont=new RiseVision.Common.Font(a["forecast-day-font"],
a["forecast-day-font-style"],a["forecast-day-font-url"],"forecastDayFont"),weather.forecastDayFontSize=a["forecast-day-font-size"],weather.forecastDayBold=a["forecast-day-bold"],weather.forecastDayItalic=a["forecast-day-italic"],weather.forecastDayColor=a["forecast-day-color"]),weather.addressFont=new RiseVision.Common.Font(a["address-font"],a["address-font-style"],a["address-font-url"],"addressFont"),weather.addressFontSize=a["address-font-size"],weather.addressBold=a["address-bold"],weather.addressItalic=
a["address-italic"],weather.addressColor=a["address-color"],prefs.getBool("show-humidity")&&(weather.humidityFont=new RiseVision.Common.Font(a["humidity-font"],a["humidity-font-style"],a["humidity-font-url"],"humidityFont"),weather.humidityFontSize=a["humidity-font-size"],weather.humidityBold=a["humidity-bold"],weather.humidityItalic=a["humidity-italic"],weather.humidityColor=a["humidity-color"]),weather.init()):"displayAddress"==b&&(a&&(c=JSON.parse(a),weather.weatherURL=weather.url+"&name="+encodeURIComponent(c.city+
","+c.province)+"&dummy="+Math.ceil(100*Math.random())),weather.getWeather())};
RiseVision.Weather.Controller.prototype.init=function(){"three-day"!=this.layout&&($(".current-temp").css("font-family",this.currentTempFont.getFontFamily()).css("font-size",this.currentTempFontSize+"px").css("color",this.currentTempColor),this.currentTempBold?$(".current-temp").css("font-weight","bold"):"",this.currentTempItalic?$(".current-temp").css("font-style","italic"):"");"current"!=this.layout&&($(".temp").css("font-family",this.forecastTempFont.getFontFamily()).css("font-size",this.forecastTempFontSize+
"px").css("color",this.forecastTempColor),this.forecastTempBold?$(".temp").css("font-weight","bold"):"",this.forecastTempItalic?$(".temp").css("font-style","italic"):"",$(".day-of-week").css("font-family",this.forecastDayFont.getFontFamily()).css("font-size",this.forecastDayFontSize+"px").css("color",this.forecastDayColor),this.forecastDayBold?$(".day-of-week").css("font-weight","bold"):"",this.forecastDayItalic?$(".day-of-week").css("font-style","italic"):"");$(".city").css("font-family",this.addressFont.getFontFamily()).css("font-size",
this.addressFontSize+"px").css("color",this.addressColor);this.addressBold?$(".city").css("font-weight","bold"):"";this.addressItalic?$(".city").css("font-style","italic"):"";prefs.getBool("show-humidity")&&($(".humidity-wind").css("font-family",this.humidityFont.getFontFamily()).css("font-size",this.humidityFontSize+"px").css("color",this.humidityColor),this.humidityBold?$(".humidity-wind").css("font-weight","bold"):"",this.humidityItalic?$(".humidity-wind").css("font-style","italic"):"");this.getLocation()};
RiseVision.Weather.Controller.prototype.getLocation=function(){var b=prefs.getString("id"),a=prefs.getString("address"),c=prefs.getString("custom-address");"geolocation"==a?this.useGeolocation():"display"==a?b&&gadgets.rpc.call("","rsparam_get",null,b,"displayAddress"):"custom"==a&&""!=c&&(this.weatherURL=this.url+"&name="+encodeURIComponent(c)+"&dummy="+Math.ceil(100*Math.random()),this.getWeather())};
RiseVision.Weather.Controller.prototype.useGeolocation=function(){var b=this;this.supportsGeolocation()&&navigator.geolocation.getCurrentPosition(function(a){b.getPosition.call(b,a)},function(a){console.log("Unable to obtain geolocation position.");setTimeout(function(){b.getLocation()},b.errorInterval)})};RiseVision.Weather.Controller.prototype.supportsGeolocation=function(){return!!navigator.geolocation};
RiseVision.Weather.Controller.prototype.getPosition=function(b){this.weatherURL=this.geoURL+"&lat="+b.coords.latitude+"&lon="+b.coords.longitude+"&dummy="+Math.ceil(100*Math.random());this.getWeather()};RiseVision.Weather.Controller.prototype.getWeather=function(){var b=this,a={};this.weatherURL?(a[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.weatherURL,function(a){b.showWeather(a)},a)):this.useGeolocation()};
RiseVision.Weather.Controller.prototype.showWeather=function(b){var a=this,c=[],e=(new Date).getDay()+1,g=7<e+1?1:e+1,z=7<g+1?1:g+1,s=!1,n=!1,t=prefs.getString("description"),p=prefs.getString("wind-speed"),u=prefs.getString("layout"),f,d,q,h,k,l,m,r,v,w,x,y;0<b.errors.length?(console.log("Unable to connect to the weather service at "+new Date+". Please check your Internet connection."),setTimeout(function(){a.getLocation()},a.errorInterval)):(b.data?0<b.data.getElementsByTagName("cw_error").length?
this.retry():(f=b.data,$(".container").show(),$(".error").hide(),i18n.init({fallbackLng:"en"},function(b){$(".container").i18n();$.each(f.getElementsByTagName("observation"),function(a,b){if(0!=a&&(q=b.getAttribute("icon_name"),null!=q&&"cw_no_report_icon"!=q))return d=this,!1});null==d&&(d=1<f.getElementsByTagName("observation").length?f.getElementsByTagName("observation")[1]:f.getElementsByTagName("observation")[0]);d&&"three-day"!=u&&(d.getAttribute("icon_name")?(a.loadImage(d.getAttribute("icon_name"),
$(".current-icon")),$(".current-icon").attr("title",d.getAttribute("description"))):$(".current-icon").hide(),$(".current-temp").html("celsius"==prefs.getString("unit")?a.convertTemp(d.getAttribute("temperature"))+"&#176;C":a.convertTemp(d.getAttribute("temperature"))+"&#176;F"));"custom"==t?($(".city").text(a.customDescription),n=!0):"service"==t&&(k=f.getElementsByTagName("location")[0])&&(l=k.getAttribute("city_name"),k.getAttribute("state_name")&&(l+=", "+k.getAttribute("state_name")),$(".city").text(l),
n=!0);d&&(prefs.getBool("show-humidity")?(r=i18n.t(d.getAttribute("wind_short")),p=prefs.getString("wind-speed"),isNaN(d.getAttribute("humidity"))||$(".humidity").text(i18n.t("humidity")+" "+d.getAttribute("humidity")+"%"),"mph"===p?d.getAttribute("wind_short")&&d.getAttribute("wind_speed")&&$(".wind").text(i18n.t("wind")+" "+r+" "+i18n.t("at")+" "+parseInt(d.getAttribute("wind_speed"))+" "+i18n.t("mph")):"kph"===p&&d.getAttribute("wind_short")&&d.getAttribute("wind_speed")&&(v=parseInt(d.getAttribute("wind_speed")),
w=Math.round(1.609344*v),$(".wind").text(i18n.t("wind")+" "+r+" "+i18n.t("at")+" "+w+" "+i18n.t("kph"))),s=!0):$(".humidity-wind").hide());s||n||$(".info").hide();if(h=f.getElementsByTagName("forecast")){if("current"!=u)for(i=0;i<h.length;i++)m=h[i].getAttribute("day_of_week"),m==e?c[0]=h[i]:m==g?c[1]=h[i]:m==z&&(c[2]=h[i]);$(".icon").each(function(b){c[b].getAttribute("icon_name")?(a.loadImage(c[b].getAttribute("icon_name"),$(this)),$(this).attr("title",c[b].getAttribute("description"))):$(this).hide()});
$(".day-of-week").each(function(a){$(this).html(i18n.t(c[a].getAttribute("weekday").toLowerCase()))});$(".temp").each(function(b){x=a.convertTemp(c[b].getAttribute("low_temp"));y=a.convertTemp(c[b].getAttribute("high_temp"));$(this).html(x+"&#176; / "+y+"&#176;")})}setTimeout(function(){a.getLocation()},a.refreshInterval)})):this.retry(),this.isLoading&&(this.isLoading=!1,readyEvent()))};
RiseVision.Weather.Controller.prototype.retry=function(){var b=this;this.isLoading&&($(".container").hide(),$(".error").text("Unable to retrieve weather data for that location.").show());setTimeout(function(){b.getLocation()},this.errorInterval)};
RiseVision.Weather.Controller.prototype.loadImage=function(b,a){var c=this,e=new Image,g=this.hostURL+"images/"+b+".png";e.onload=function(){a.attr("src",g);c.onImageLoaded()};e.onerror=function(){console.log("Image "+b+" not found on "+new Date+" for "+$(".city").text());c.onImageLoaded()};e.src=g};
RiseVision.Weather.Controller.prototype.onImageLoaded=function(b,a){this.imagesLoaded++;"current"==prefs.getString("layout")?1==this.imagesLoaded&&$(document).trigger("dataPopulated"):"three-day"==prefs.getString("layout")?3==this.imagesLoaded&&$(document).trigger("dataPopulated"):"current-and-three-day"==prefs.getString("layout")?4==this.imagesLoaded&&$(document).trigger("dataPopulated"):$(document).trigger("dataPopulated")};
RiseVision.Weather.Controller.prototype.convertTemp=function(b){return"celsius"==prefs.getString("unit")?parseInt(5*(b-32)/9):parseInt(b)};